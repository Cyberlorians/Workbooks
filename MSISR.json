{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## ATO Logging Validation\nValidates every architecture component from the Azure Gov landing zone is sending logs to Sentinel.  \n✅ Ingesting &nbsp;|&nbsp; ⚠️ Validated (table exists, no data) &nbsp;|&nbsp; ❌ Not Configured (enable connector)  "
      },
      "customWidth": "100",
      "name": "Header"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedSubscription",
                  "label": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "includeAll": true,
                    "showDefault": false
                  },
                  "defaultValue": "value::all"
                },
                {
                  "id": "4853246f-5135-4586-a6a0-9e88edd4534b",
                  "version": "KqlParameterItem/1.0",
                  "name": "Workspace",
                  "label": "Log Analytics Workspace",
                  "type": 5,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                  "crossComponentResources": [
                    "{SelectedSubscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "4d2aad49-d67d-4070-9fac-b0f14734b819",
                  "version": "KqlParameterItem/1.0",
                  "name": "TimeRange",
                  "label": "Time Range",
                  "type": 2,
                  "isRequired": true,
                  "jsonData": "[{\"value\": \"1d\", \"label\": \"Last 1 day\"}, {\"value\": \"3d\", \"label\": \"Last 3 days\"}, {\"value\": \"7d\", \"label\": \"Last 7 days\"}, {\"value\": \"14d\", \"label\": \"Last 14 days\", \"selected\": true}, {\"value\": \"30d\", \"label\": \"Last 30 days\"}, {\"value\": \"90d\", \"label\": \"Last 90 days\"}]",
                  "value": "7d"
                },
                {
                  "id": "743f807f-6432-454a-9024-bc55b8118f2e",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedComponent",
                  "label": "Workload",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"Azure API Management\", \"label\": \"Azure API Management\"}, {\"value\": \"Azure Activity\", \"label\": \"Azure Activity\"}, {\"value\": \"Azure Application Gateway\", \"label\": \"Azure Application Gateway\"}, {\"value\": \"Azure Automation Account\", \"label\": \"Azure Automation Account\"}, {\"value\": \"Azure Cognitive Search\", \"label\": \"Azure Cognitive Search\"}, {\"value\": \"Azure Container Registry\", \"label\": \"Azure Container Registry\"}, {\"value\": \"Azure Firewall\", \"label\": \"Azure Firewall\"}, {\"value\": \"Azure Key Vault\", \"label\": \"Azure Key Vault\"}, {\"value\": \"Azure Kubernetes Service\", \"label\": \"Azure Kubernetes Service\"}, {\"value\": \"Azure Load Balancer\", \"label\": \"Azure Load Balancer\"}, {\"value\": \"Azure Recovery Services Vault\", \"label\": \"Azure Recovery Services Vault\"}, {\"value\": \"Azure Virtual Desktop\", \"label\": \"Azure Virtual Desktop\"}, {\"value\": \"Entra ID\", \"label\": \"Entra ID\"}, {\"value\": \"Log Analytics Workspace\", \"label\": \"Log Analytics Workspace\"}, {\"value\": \"Network Interface\", \"label\": \"Network Interface\"}, {\"value\": \"Network Security Group\", \"label\": \"Network Security Group\"}, {\"value\": \"Public IP Address\", \"label\": \"Public IP Address\"}, {\"value\": \"VNET Flow Logs\", \"label\": \"VNET Flow Logs\"}, {\"value\": \"Virtual Network Gateway\", \"label\": \"Virtual Network Gateway\"}]"
                },
                {
                  "id": "e775eb56-8f17-4fac-95f5-1ccfdaa3a189",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedFamily",
                  "label": "Control Family",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"AC\", \"label\": \"AC - Access Control\"}, {\"value\": \"AU\", \"label\": \"AU - Audit & Accountability\"}, {\"value\": \"CM\", \"label\": \"CM - Configuration Management\"}, {\"value\": \"CP\", \"label\": \"CP - Contingency Planning\"}, {\"value\": \"IA\", \"label\": \"IA - Identification & Authentication\"}, {\"value\": \"IR\", \"label\": \"IR - Incident Response\"}, {\"value\": \"RA\", \"label\": \"RA - Risk Assessment\"}, {\"value\": \"SC\", \"label\": \"SC - System & Communications Protection\"}, {\"value\": \"SI\", \"label\": \"SI - System & Information Integrity\"}]"
                },
                {
                  "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedTableFilter",
                  "label": "Table",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedStatus",
                  "label": "Status",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"Ingesting\", \"label\": \"Ingesting\"}, {\"value\": \"Validated\", \"label\": \"Validated - No Data\"}, {\"value\": \"Not Configured\", \"label\": \"Not Configured\"}]"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "name": "Global Parameters"
          }
        ],
        "exportParameters": true
      },
      "name": "ParentGroup"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, CheckId:string, SentinelTable:string) [\r\n    'Entra ID', 'SigninLogs', 'SigninLogs',\r\n    'Entra ID', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs',\r\n    'Entra ID', 'AuditLogs', 'AuditLogs',\r\n    'Entra ID', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs',\r\n    'Entra ID', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs',\r\n    'Entra ID', 'AADProvisioningLogs', 'AADProvisioningLogs',\r\n    'Entra ID', 'AADRiskyUsers', 'AADRiskyUsers',\r\n    'Entra ID', 'AADUserRiskEvents', 'AADUserRiskEvents',\r\n    'Entra ID', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals',\r\n    'Entra ID', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents',\r\n    'Entra ID', 'ADFSSignInLogs', 'ADFSSignInLogs',\r\n    'Entra ID', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs',\r\n    'Azure Activity', 'AzureActivity', 'AzureActivity',\r\n    'Azure Automation Account', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics',\r\n    'Azure Container Registry', 'AzDiag_REGISTRIES', 'AzureDiagnostics',\r\n    'Azure Kubernetes Service', 'AzDiag_MANAGEDCLUSTERS', 'AzureDiagnostics',\r\n    'Azure API Management', 'AzDiag_SERVICE', 'AzureDiagnostics',\r\n    'Azure Application Gateway', 'AzDiag_APPLICATIONGATEWAYS', 'AzureDiagnostics',\r\n    'Azure Firewall', 'AZFWApplicationRule', 'AZFWApplicationRule',\r\n    'Azure Firewall', 'AZFWNetworkRule', 'AZFWNetworkRule',\r\n    'Azure Firewall', 'AZFWThreatIntel', 'AZFWThreatIntel',\r\n    'Azure Firewall', 'AZFWDnsQuery', 'AZFWDnsQuery',\r\n    'Azure Firewall', 'AZFWNatRule', 'AZFWNatRule',\r\n    'Azure Firewall', 'AZFWIdpsSignature', 'AZFWIdpsSignature',\r\n    'Azure Firewall', 'AZFWFlowTrace', 'AZFWFlowTrace',\r\n    'Azure Virtual Desktop', 'WVDConnections', 'WVDConnections',\r\n    'Azure Virtual Desktop', 'WVDCheckpoints', 'WVDCheckpoints',\r\n    'Azure Virtual Desktop', 'WVDErrors', 'WVDErrors',\r\n    'Azure Virtual Desktop', 'WVDManagement', 'WVDManagement',\r\n    'Azure Virtual Desktop', 'WVDHostRegistrations', 'WVDHostRegistrations',\r\n    'Azure Virtual Desktop', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus',\r\n    'Azure Virtual Desktop', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData',\r\n    'Azure Virtual Desktop', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview',\r\n    'Azure Virtual Desktop', 'WVDSessionHostManagement', 'WVDSessionHostManagement',\r\n    'Azure Virtual Desktop', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled',\r\n    'Azure Virtual Desktop', 'WVDFeeds', 'WVDFeeds',\r\n    'Azure Key Vault', 'AzDiag_VAULTS', 'AzureDiagnostics',\r\n    'Azure Key Vault', 'AZKVAuditLogs', 'AZKVAuditLogs',\r\n    'Azure Key Vault', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs',\r\n    'Azure Load Balancer', 'AzDiag_LOADBALANCERS', 'AzureDiagnostics',\r\n    'Log Analytics Workspace', 'AzDiag_WORKSPACES_LA', 'AzureDiagnostics',\r\n    'Network Interface', 'AzDiag_NETWORKINTERFACES', 'AzureDiagnostics',\r\n    'Network Security Group', 'AzDiag_NETWORKSECURITYGROUPS', 'AzureDiagnostics',\r\n    'Public IP Address', 'AzDiag_PUBLICIPADDRESSES', 'AzureDiagnostics',\r\n    'Azure Recovery Services Vault', 'CoreAzureBackup', 'CoreAzureBackup',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance',\r\n    'Azure Recovery Services Vault', 'AzureBackupOperations', 'AzureBackupOperations',\r\n    'Azure Recovery Services Vault', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics',\r\n    'Azure Recovery Services Vault', 'ASRJobs', 'ASRJobs',\r\n    'Azure Recovery Services Vault', 'ASRReplicatedItems', 'ASRReplicatedItems',\r\n    'Azure Cognitive Search', 'AzDiag_SEARCHSERVICES', 'AzureDiagnostics',\r\n    'Virtual Network Gateway', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics',\r\n    'VNET Flow Logs', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL',\r\n    'VNET Flow Logs', 'NTANetAnalytics', 'NTANetAnalytics'\r\n];\r\nlet Filtered = Expected | where '{SelectedComponent}' == 'All' or Workload == '{SelectedComponent}';\r\nlet TotalExpected = toscalar(Filtered | count);\r\nlet SchemaCheck = union isfuzzy=true\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (ADFSSignInLogs | getschema | take 1 | project T='ADFSSignInLogs'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADServicePrincipalRiskEvents'),\r\n    (ADFSSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ADFSSignInLogs'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureActivity'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (AzureDiagnostics | where ResourceType == \"REGISTRIES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_REGISTRIES'),\r\n    (AzureDiagnostics | where ResourceType == \"MANAGEDCLUSTERS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_MANAGEDCLUSTERS'),\r\n    (AzureDiagnostics | where ResourceType == \"SERVICE\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_SERVICE'),\r\n    (AzureDiagnostics | where ResourceType == \"APPLICATIONGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_APPLICATIONGATEWAYS'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWFlowTrace'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDFeeds'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AzureDiagnostics | where ResourceType == \"LOADBALANCERS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_LOADBALANCERS'),\r\n    (AzureDiagnostics | where ResourceType == \"WORKSPACES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_WORKSPACES_LA'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKINTERFACES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_NETWORKINTERFACES'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKSECURITYGROUPS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_NETWORKSECURITYGROUPS'),\r\n    (AzureDiagnostics | where ResourceType == \"PUBLICIPADDRESSES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_PUBLICIPADDRESSES'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ASRReplicatedItems'),\r\n    (AzureDiagnostics | where ResourceType == \"SEARCHSERVICES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_SEARCHSERVICES'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='NTANetAnalytics')\r\n| distinct CheckId;\r\nFiltered\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend HasData = CheckId in (DataCheck)\r\n| extend State = case(HasData, 'Ingesting', TableInSchema, 'Validated', 'NotConfigured')\r\n| summarize Ingesting=countif(State=='Ingesting'), Validated=countif(State=='Validated'), NotConfigured=countif(State=='NotConfigured')\r\n| extend Total = Ingesting + Validated + NotConfigured\r\n| extend CoveragePct = round(todouble(Ingesting) / Total * 100, 1)\r\n| project ['\\u2705 Ingesting']=Ingesting, ['\\u26a0\\ufe0f Validated']=Validated, ['\\u274c Not Configured']=NotConfigured, Total, ['Coverage %']=CoveragePct",
        "size": 4,
        "title": "ATO Readiness",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Ingesting",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            },
            {
              "columnMatch": "Validated",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            },
            {
              "columnMatch": "Not Configured",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "155px"
              }
            },
            {
              "columnMatch": "Total",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "70px"
              }
            },
            {
              "columnMatch": "Coverage %",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">=",
                    "thresholdValue": "80",
                    "representation": "green",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "60",
                    "representation": "yellow",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "40",
                    "representation": "orange",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": "Default",
                    "representation": "redBright",
                    "text": "{0}{1}%"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            }
          ]
        }
      },
      "customWidth": "30",
      "name": "Readiness Summary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, CheckId:string, SentinelTable:string) [\r\n    'Entra ID', 'SigninLogs', 'SigninLogs',\r\n    'Entra ID', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs',\r\n    'Entra ID', 'AuditLogs', 'AuditLogs',\r\n    'Entra ID', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs',\r\n    'Entra ID', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs',\r\n    'Entra ID', 'AADProvisioningLogs', 'AADProvisioningLogs',\r\n    'Entra ID', 'AADRiskyUsers', 'AADRiskyUsers',\r\n    'Entra ID', 'AADUserRiskEvents', 'AADUserRiskEvents',\r\n    'Entra ID', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals',\r\n    'Entra ID', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents',\r\n    'Entra ID', 'ADFSSignInLogs', 'ADFSSignInLogs',\r\n    'Entra ID', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs',\r\n    'Azure Activity', 'AzureActivity', 'AzureActivity',\r\n    'Azure Automation Account', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics',\r\n    'Azure Container Registry', 'AzDiag_REGISTRIES', 'AzureDiagnostics',\r\n    'Azure Kubernetes Service', 'AzDiag_MANAGEDCLUSTERS', 'AzureDiagnostics',\r\n    'Azure API Management', 'AzDiag_SERVICE', 'AzureDiagnostics',\r\n    'Azure Application Gateway', 'AzDiag_APPLICATIONGATEWAYS', 'AzureDiagnostics',\r\n    'Azure Firewall', 'AZFWApplicationRule', 'AZFWApplicationRule',\r\n    'Azure Firewall', 'AZFWNetworkRule', 'AZFWNetworkRule',\r\n    'Azure Firewall', 'AZFWThreatIntel', 'AZFWThreatIntel',\r\n    'Azure Firewall', 'AZFWDnsQuery', 'AZFWDnsQuery',\r\n    'Azure Firewall', 'AZFWNatRule', 'AZFWNatRule',\r\n    'Azure Firewall', 'AZFWIdpsSignature', 'AZFWIdpsSignature',\r\n    'Azure Firewall', 'AZFWFlowTrace', 'AZFWFlowTrace',\r\n    'Azure Virtual Desktop', 'WVDConnections', 'WVDConnections',\r\n    'Azure Virtual Desktop', 'WVDCheckpoints', 'WVDCheckpoints',\r\n    'Azure Virtual Desktop', 'WVDErrors', 'WVDErrors',\r\n    'Azure Virtual Desktop', 'WVDManagement', 'WVDManagement',\r\n    'Azure Virtual Desktop', 'WVDHostRegistrations', 'WVDHostRegistrations',\r\n    'Azure Virtual Desktop', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus',\r\n    'Azure Virtual Desktop', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData',\r\n    'Azure Virtual Desktop', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview',\r\n    'Azure Virtual Desktop', 'WVDSessionHostManagement', 'WVDSessionHostManagement',\r\n    'Azure Virtual Desktop', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled',\r\n    'Azure Virtual Desktop', 'WVDFeeds', 'WVDFeeds',\r\n    'Azure Key Vault', 'AzDiag_VAULTS', 'AzureDiagnostics',\r\n    'Azure Key Vault', 'AZKVAuditLogs', 'AZKVAuditLogs',\r\n    'Azure Key Vault', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs',\r\n    'Azure Load Balancer', 'AzDiag_LOADBALANCERS', 'AzureDiagnostics',\r\n    'Log Analytics Workspace', 'AzDiag_WORKSPACES_LA', 'AzureDiagnostics',\r\n    'Network Interface', 'AzDiag_NETWORKINTERFACES', 'AzureDiagnostics',\r\n    'Network Security Group', 'AzDiag_NETWORKSECURITYGROUPS', 'AzureDiagnostics',\r\n    'Public IP Address', 'AzDiag_PUBLICIPADDRESSES', 'AzureDiagnostics',\r\n    'Azure Recovery Services Vault', 'CoreAzureBackup', 'CoreAzureBackup',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts',\r\n    'Azure Recovery Services Vault', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance',\r\n    'Azure Recovery Services Vault', 'AzureBackupOperations', 'AzureBackupOperations',\r\n    'Azure Recovery Services Vault', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics',\r\n    'Azure Recovery Services Vault', 'ASRJobs', 'ASRJobs',\r\n    'Azure Recovery Services Vault', 'ASRReplicatedItems', 'ASRReplicatedItems',\r\n    'Azure Cognitive Search', 'AzDiag_SEARCHSERVICES', 'AzureDiagnostics',\r\n    'Virtual Network Gateway', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics',\r\n    'VNET Flow Logs', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL',\r\n    'VNET Flow Logs', 'NTANetAnalytics', 'NTANetAnalytics'\r\n];\r\nlet SchemaCheck = union isfuzzy=true\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (ADFSSignInLogs | getschema | take 1 | project T='ADFSSignInLogs'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADServicePrincipalRiskEvents'),\r\n    (ADFSSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='ADFSSignInLogs'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=SubscriptionId | extend CheckId='AzureActivity'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (AzureDiagnostics | where ResourceType == \"REGISTRIES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_REGISTRIES'),\r\n    (AzureDiagnostics | where ResourceType == \"MANAGEDCLUSTERS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_MANAGEDCLUSTERS'),\r\n    (AzureDiagnostics | where ResourceType == \"SERVICE\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_SERVICE'),\r\n    (AzureDiagnostics | where ResourceType == \"APPLICATIONGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_APPLICATIONGATEWAYS'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWFlowTrace'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDFeeds'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AzureDiagnostics | where ResourceType == \"LOADBALANCERS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_LOADBALANCERS'),\r\n    (AzureDiagnostics | where ResourceType == \"WORKSPACES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_WORKSPACES_LA'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKINTERFACES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_NETWORKINTERFACES'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKSECURITYGROUPS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_NETWORKSECURITYGROUPS'),\r\n    (AzureDiagnostics | where ResourceType == \"PUBLICIPADDRESSES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_PUBLICIPADDRESSES'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='ASRReplicatedItems'),\r\n    (AzureDiagnostics | where ResourceType == \"SEARCHSERVICES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_SEARCHSERVICES'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='NTANetAnalytics')\r\n;\r\nExpected\r\n| join kind=leftouter (DataCheck) on CheckId\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend State = case(isnotnull(Last), 'Ingesting', TableInSchema, 'Validated', 'Not Configured')\r\n| distinct Workload, CheckId, State\r\n| summarize ['Ingesting']=countif(State=='Ingesting'), ['Validated No Data']=countif(State=='Validated'), ['Not Configured']=countif(State=='Not Configured') by Workload\r\n| sort by ['Not Configured'] desc, Workload asc",
        "size": 1,
        "title": "Coverage by Workload",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "xAxis": "Workload",
          "yAxis": [
            "Ingesting",
            "Validated No Data",
            "Not Configured"
          ],
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "Ingesting",
              "color": "green"
            },
            {
              "seriesName": "Validated No Data",
              "color": "yellow"
            },
            {
              "seriesName": "Not Configured",
              "color": "redBright"
            }
          ]
        }
      },
      "customWidth": "60",
      "name": "Coverage Bar Chart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, DisplayName:string, CheckId:string, SentinelTable:string, EnableLink:string, Controls:string, ResourceFilter:string) [\r\n    'Entra ID', 'Sign-in Logs', 'SigninLogs', 'SigninLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2, AU-3', '',\r\n    'Entra ID', 'Non-Interactive Sign-ins', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2, AU-3', '',\r\n    'Entra ID', 'Audit Logs', 'AuditLogs', 'AuditLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, AC-6, AU-2, AU-3, AU-12', '',\r\n    'Entra ID', 'Service Principal Sign-ins', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2', '',\r\n    'Entra ID', 'Managed Identity Sign-ins', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, IA-4, AU-2', '',\r\n    'Entra ID', 'Provisioning Logs', 'AADProvisioningLogs', 'AADProvisioningLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, AU-2, AU-12', '',\r\n    'Entra ID', 'Risky Users', 'AADRiskyUsers', 'AADRiskyUsers', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'User Risk Events', 'AADUserRiskEvents', 'AADUserRiskEvents', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'Risky Service Principals', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4', '',\r\n    'Entra ID', 'SP Risk Events', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'ADFS Sign-in Logs', 'ADFSSignInLogs', 'ADFSSignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2', '',\r\n    'Entra ID', 'Graph Activity Logs', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs', 'https://learn.microsoft.com/graph/microsoft-graph-activity-logs-overview', 'AC-2, AC-6, AU-2, AU-3, SI-4', '',\r\n    'Azure Activity', 'Activity Logs', 'AzureActivity', 'AzureActivity', 'https://learn.microsoft.com/azure/azure-monitor/essentials/activity-log', 'AU-2, AU-3, AU-6, AU-12, CM-3', '',\r\n    'Azure Automation Account', 'Automation Diagnostics', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/automation/automation-manage-send-joblogs-log-analytics', 'CM-3, CM-6, AU-2, AU-12', 'AUTOMATIONACCOUNTS',\r\n    'Azure Container Registry', 'Registry Diagnostics', 'AzDiag_REGISTRIES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/container-registry/monitor-service', 'AU-2, AU-3, CM-8, SI-4', 'REGISTRIES',\r\n    'Azure Kubernetes Service', 'AKS Diagnostics', 'AzDiag_MANAGEDCLUSTERS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/aks/monitor-aks', 'AU-2, AU-3, CM-6, SI-4', 'MANAGEDCLUSTERS',\r\n    'Azure API Management', 'APIM Diagnostics', 'AzDiag_SERVICE', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/api-management/api-management-howto-use-azure-monitor', 'AU-2, AU-3, AC-4, SI-4', 'SERVICE',\r\n    'Azure Application Gateway', 'App Gateway Diagnostics', 'AzDiag_APPLICATIONGATEWAYS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/application-gateway/application-gateway-diagnostics', 'SC-7, AU-2, SI-4, AC-4', 'APPLICATIONGATEWAYS',\r\n    'Azure Firewall', 'Application Rules', 'AZFWApplicationRule', 'AZFWApplicationRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'Azure Firewall', 'Network Rules', 'AZFWNetworkRule', 'AZFWNetworkRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'Azure Firewall', 'Threat Intel', 'AZFWThreatIntel', 'AZFWThreatIntel', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SI-4, SI-3', '',\r\n    'Azure Firewall', 'DNS Queries', 'AZFWDnsQuery', 'AZFWDnsQuery', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SC-20, SI-4', '',\r\n    'Azure Firewall', 'NAT Rules', 'AZFWNatRule', 'AZFWNatRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, AC-4', '',\r\n    'Azure Firewall', 'IDPS Signatures', 'AZFWIdpsSignature', 'AZFWIdpsSignature', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SI-3, SI-4', '',\r\n    'Azure Firewall', 'Flow Trace', 'AZFWFlowTrace', 'AZFWFlowTrace', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'Azure Virtual Desktop', 'Connections', 'WVDConnections', 'WVDConnections', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-2, AC-17, AU-2, AU-3', '',\r\n    'Azure Virtual Desktop', 'Checkpoints', 'WVDCheckpoints', 'WVDCheckpoints', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AU-2, AU-3, SI-4', '',\r\n    'Azure Virtual Desktop', 'Errors', 'WVDErrors', 'WVDErrors', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AU-2, SI-4, SI-11', '',\r\n    'Azure Virtual Desktop', 'Management', 'WVDManagement', 'WVDManagement', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-6, AU-2', '',\r\n    'Azure Virtual Desktop', 'Host Registrations', 'WVDHostRegistrations', 'WVDHostRegistrations', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-8, AU-2', '',\r\n    'Azure Virtual Desktop', 'Agent Health Status', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'SI-4, CM-8, AU-2', '',\r\n    'Azure Virtual Desktop', 'Connection Network Data', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-17, SC-7, AU-2', '',\r\n    'Azure Virtual Desktop', 'Connection Graphics Preview', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-17, AU-2', '',\r\n    'Azure Virtual Desktop', 'Session Host Mgmt', 'WVDSessionHostManagement', 'WVDSessionHostManagement', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-6, AU-2', '',\r\n    'Azure Virtual Desktop', 'Autoscale Pooled', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-6, AU-2', '',\r\n    'Azure Virtual Desktop', 'Feeds', 'WVDFeeds', 'WVDFeeds', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-2, AU-2, CM-6', '',\r\n    'Azure Key Vault', 'Key Vault Audit Events', 'AzDiag_VAULTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, SC-28, AU-2, AU-3, AC-6', 'VAULTS',\r\n    'Azure Key Vault', 'KV Audit Logs (Resource)', 'AZKVAuditLogs', 'AZKVAuditLogs', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, SC-28, AU-2, AU-3, AC-6', '',\r\n    'Azure Key Vault', 'KV Policy Evaluation', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, CM-6, AU-2', '',\r\n    'Azure Load Balancer', 'LB Diagnostics', 'AzDiag_LOADBALANCERS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/load-balancer/monitor-load-balancer', 'SC-7, AU-2, SI-4', 'LOADBALANCERS',\r\n    'Log Analytics Workspace', 'LA Workspace Diagnostics', 'AzDiag_WORKSPACES_LA', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/azure-monitor/logs/monitor-workspace', 'AU-2, AU-3, AU-12, AC-6', 'WORKSPACES',\r\n    'Network Interface', 'NIC Diagnostics', 'AzDiag_NETWORKINTERFACES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/virtual-network/monitor-virtual-network', 'SC-7, AU-2, SI-4', 'NETWORKINTERFACES',\r\n    'Network Security Group', 'NSG Diagnostics', 'AzDiag_NETWORKSECURITYGROUPS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/network-watcher/nsg-flow-logs-overview', 'SC-7, AU-2, SI-4, AC-4', 'NETWORKSECURITYGROUPS',\r\n    'Public IP Address', 'PIP Diagnostics', 'AzDiag_PUBLICIPADDRESSES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/virtual-network/ip-services/monitor-public-ip', 'SC-7, AU-2, SI-4', 'PUBLICIPADDRESSES',\r\n    'Azure Recovery Services Vault', 'Core Backup', 'CoreAzureBackup', 'CoreAzureBackup', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Azure Recovery Services Vault', 'Backup Jobs', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Azure Recovery Services Vault', 'Backup Policy', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, CM-6', '',\r\n    'Azure Recovery Services Vault', 'Backup Storage', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Azure Recovery Services Vault', 'Backup Alerts', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, SI-4', '',\r\n    'Azure Recovery Services Vault', 'Protected Instances', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, CM-8', '',\r\n    'Azure Recovery Services Vault', 'Backup Operations', 'AzureBackupOperations', 'AzureBackupOperations', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Azure Recovery Services Vault', 'ASR Events', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, AU-2', 'VAULTS',\r\n    'Azure Recovery Services Vault', 'ASR Jobs', 'ASRJobs', 'ASRJobs', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, AU-2', '',\r\n    'Azure Recovery Services Vault', 'ASR Replicated Items', 'ASRReplicatedItems', 'ASRReplicatedItems', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, CM-8', '',\r\n    'Azure Cognitive Search', 'Search Diagnostics', 'AzDiag_SEARCHSERVICES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/search/monitor-azure-cognitive-search', 'AU-2, AU-3, SI-4', 'SEARCHSERVICES',\r\n    'Virtual Network Gateway', 'Gateway Diagnostics', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/vpn-gateway/monitor-vpn-gateway', 'SC-7, AC-17, AU-2, SC-8', 'VPNGATEWAYS',\r\n    'VNET Flow Logs', 'Network Analytics', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL', 'https://learn.microsoft.com/azure/network-watcher/vnet-flow-logs-overview', 'SC-7, AU-2, AU-3, SI-4, AC-4', '',\r\n    'VNET Flow Logs', 'NTA Net Analytics', 'NTANetAnalytics', 'NTANetAnalytics', 'https://learn.microsoft.com/azure/network-watcher/traffic-analytics', 'SC-7, AU-2, SI-4, AC-4', ''\r\n];\r\nlet SchemaCheck = union isfuzzy=true\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (ADFSSignInLogs | getschema | take 1 | project T='ADFSSignInLogs'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='AADServicePrincipalRiskEvents'),\r\n    (ADFSSignInLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='ADFSSignInLogs'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) | extend SourceSub=\"Tenant-wide\", CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=SubscriptionId | extend CheckId='AzureActivity'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (AzureDiagnostics | where ResourceType == \"REGISTRIES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_REGISTRIES'),\r\n    (AzureDiagnostics | where ResourceType == \"MANAGEDCLUSTERS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_MANAGEDCLUSTERS'),\r\n    (AzureDiagnostics | where ResourceType == \"SERVICE\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_SERVICE'),\r\n    (AzureDiagnostics | where ResourceType == \"APPLICATIONGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_APPLICATIONGATEWAYS'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZFWFlowTrace'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='WVDFeeds'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (AzureDiagnostics | where ResourceType == \"LOADBALANCERS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_LOADBALANCERS'),\r\n    (AzureDiagnostics | where ResourceType == \"WORKSPACES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_WORKSPACES_LA'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKINTERFACES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_NETWORKINTERFACES'),\r\n    (AzureDiagnostics | where ResourceType == \"NETWORKSECURITYGROUPS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_NETWORKSECURITYGROUPS'),\r\n    (AzureDiagnostics | where ResourceType == \"PUBLICIPADDRESSES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_PUBLICIPADDRESSES'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='ASRReplicatedItems'),\r\n    (AzureDiagnostics | where ResourceType == \"SEARCHSERVICES\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_SEARCHSERVICES'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | summarize Last=max(TimeGenerated) by SourceSub=extract(\"/subscriptions/([^/]+)/\", 1, tostring(_ResourceId)) | extend CheckId='NTANetAnalytics')\r\n;\r\nExpected\r\n| join kind=leftouter (DataCheck) on CheckId\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend Status = case(\r\n    isnotnull(Last), 'Ingesting',\r\n    TableInSchema, 'Validated - No Data',\r\n    'Not Configured')\r\n| extend LastSeen = case(\r\n    isnotnull(Last), format_datetime(Last, 'yyyy-MM-dd HH:mm'),\r\n    TableInSchema, 'schema only, no data in range',\r\n    'not in workspace')\r\n| extend Source = case(\r\n    isnotempty(SourceSub), SourceSub,\r\n    Status == 'Not Configured', 'N/A',\r\n    'no data')\r\n| where '{SelectedComponent}' == 'All' or Workload == '{SelectedComponent}'\r\n| where '{SelectedFamily}' == 'All' or Controls has '{SelectedFamily}'\r\n| where '{SelectedTableFilter}' == '' or SentinelTable contains '{SelectedTableFilter}'\r\n| where '{SelectedStatus}' == 'All' or Status has '{SelectedStatus}'\r\n| extend _fam = strcat(\r\n    iff(Controls has 'AC-', 'Access Control, ', ''),\r\n    iff(Controls has 'AU-', 'Audit & Accountability, ', ''),\r\n    iff(Controls has 'CM-', 'Config Management, ', ''),\r\n    iff(Controls has 'CP-', 'Contingency Planning, ', ''),\r\n    iff(Controls has 'IA-', 'Identification & Auth, ', ''),\r\n    iff(Controls has 'IR-', 'Incident Response, ', ''),\r\n    iff(Controls has 'RA-', 'Risk Assessment, ', ''),\r\n    iff(Controls has 'SC-', 'System & Comms Protection, ', ''),\r\n    iff(Controls has 'SI-', 'System & Info Integrity, ', ''))\r\n| extend ['Control Family'] = trim_end(', ', _fam)\r\n| extend _sort = case(Status has 'Not', 0, Status has 'Validated', 1, 2)\r\n| sort by _sort asc, Workload asc, DisplayName asc\r\n| project Workload, Source, ['Table']=SentinelTable, Status, ['Last Record']=LastSeen, ['Control Family'], ['NIST 800-53']=Controls, ['Enable']=EnableLink, ResourceFilter",
        "size": 0,
        "showAnalytics": true,
        "title": "Table Ingestion Status",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Workload",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "200px"
              }
            },
            {
              "columnMatch": "Source",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Tenant",
                    "representation": "info",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "N/A",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "no data",
                    "representation": "question",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "340px"
              }
            },
            {
              "columnMatch": "Table",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "250px"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Ingesting",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Validated",
                    "representation": "warning",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not Configured",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "representation": "question",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "190px"
              }
            },
            {
              "columnMatch": "Last Record",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "185px"
              }
            },
            {
              "columnMatch": "Control Family",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "500px"
              }
            },
            {
              "columnMatch": "NIST 800-53",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "190px"
              }
            },
            {
              "columnMatch": "Enable",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Docs →",
                "customColumnWidthSetting": "80px"
              }
            },
            {
              "columnMatch": "ResourceFilter",
              "formatter": 5
            }
          ],
          "filter": true,
          "hierarchySettings": {
            "treeType": 2,
            "groupBy": [
              "Workload",
              "Source"
            ],
            "expandTopLevel": false
          },
          "labelSettings": [
            {
              "columnId": "Source",
              "label": "Source Subscription"
            }
          ]
        },
        "sortBy": []
      },
      "name": "Ingestion Status Table"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/4260a1bd-84f2-4114-8197-2bbf9a9350a1/resourceGroups/Sentinel/providers/Microsoft.OperationalInsights/workspaces/sentinellaw"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
