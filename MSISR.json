{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## ATO Logging Validation\nValidates every architecture component from the Azure Gov landing zone is sending logs to Sentinel.  \n✅ Ingesting &nbsp;|&nbsp; ⚠️ Validated (table exists, no data) &nbsp;|&nbsp; ❌ Not Configured (enable connector)  \n**Click any row** to preview log records from that table."
      },
      "customWidth": "100",
      "name": "Header"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedSubscription",
                  "label": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "includeAll": true,
                    "showDefault": false
                  },
                  "defaultValue": "value::all",
                  "value": [
                    "/subscriptions/ac95a806-c9d3-49e7-83ee-7f82e88c2bd3"
                  ]
                },
                {
                  "id": "4853246f-5135-4586-a6a0-9e88edd4534b",
                  "version": "KqlParameterItem/1.0",
                  "name": "Workspace",
                  "label": "Log Analytics Workspace",
                  "type": 5,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                  "crossComponentResources": [
                    "{SelectedSubscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "value": [
                    "/subscriptions/ac95a806-c9d3-49e7-83ee-7f82e88c2bd3/resourceGroups/rg-siem-shared-001/providers/Microsoft.OperationalInsights/workspaces/log-c3elz7-usgovvirginia-001"
                  ]
                },
                {
                  "id": "4d2aad49-d67d-4070-9fac-b0f14734b819",
                  "version": "KqlParameterItem/1.0",
                  "name": "TimeRange",
                  "label": "Time Range",
                  "type": 2,
                  "isRequired": true,
                  "jsonData": "[{\"value\": \"1d\", \"label\": \"Last 1 day\"}, {\"value\": \"3d\", \"label\": \"Last 3 days\"}, {\"value\": \"7d\", \"label\": \"Last 7 days\"}, {\"value\": \"14d\", \"label\": \"Last 14 days\", \"selected\": true}, {\"value\": \"30d\", \"label\": \"Last 30 days\"}, {\"value\": \"90d\", \"label\": \"Last 90 days\"}]",
                  "value": "7d"
                },
                {
                  "id": "743f807f-6432-454a-9024-bc55b8118f2e",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedComponent",
                  "label": "Workload",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"Entra ID\", \"label\": \"Entra ID\"}, {\"value\": \"Azure Activity\", \"label\": \"Azure Activity\"}, {\"value\": \"Azure Firewall\", \"label\": \"Azure Firewall\"}, {\"value\": \"VPN Gateway\", \"label\": \"VPN Gateway\"}, {\"value\": \"ExpressRoute\", \"label\": \"ExpressRoute\"}, {\"value\": \"Virtual WAN\", \"label\": \"Virtual WAN\"}, {\"value\": \"Key Vault\", \"label\": \"Key Vault\"}, {\"value\": \"Storage Account\", \"label\": \"Storage Account\"}, {\"value\": \"Recovery Services\", \"label\": \"Recovery Services\"}, {\"value\": \"NSG Flow Logs\", \"label\": \"NSG Flow Logs\"}, {\"value\": \"DNS\", \"label\": \"DNS\"}, {\"value\": \"Event Hub\", \"label\": \"Event Hub\"}, {\"value\": \"Automation Account\", \"label\": \"Automation Account\"}, {\"value\": \"AVD\", \"label\": \"AVD\"}, {\"value\": \"VMs / Hosts\", \"label\": \"VMs / Hosts\"}, {\"value\": \"SD-WAN / NVA\", \"label\": \"SD-WAN / NVA\"}, {\"value\": \"Defender for Cloud\", \"label\": \"Defender for Cloud\"}, {\"value\": \"Sentinel\", \"label\": \"Sentinel\"}]"
                },
                {
                  "id": "e775eb56-8f17-4fac-95f5-1ccfdaa3a189",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedFamily",
                  "label": "Control Family",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"AC\", \"label\": \"AC - Access Control\"}, {\"value\": \"AU\", \"label\": \"AU - Audit & Accountability\"}, {\"value\": \"CM\", \"label\": \"CM - Configuration Management\"}, {\"value\": \"CP\", \"label\": \"CP - Contingency Planning\"}, {\"value\": \"IA\", \"label\": \"IA - Identification & Authentication\"}, {\"value\": \"IR\", \"label\": \"IR - Incident Response\"}, {\"value\": \"RA\", \"label\": \"RA - Risk Assessment\"}, {\"value\": \"SC\", \"label\": \"SC - System & Communications Protection\"}, {\"value\": \"SI\", \"label\": \"SI - System & Information Integrity\"}]"
                },
                {
                  "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedTableFilter",
                  "label": "Table",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedStatus",
                  "label": "Status",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"All\", \"label\": \"All\", \"selected\": true}, {\"value\": \"Ingesting\", \"label\": \"Ingesting\"}, {\"value\": \"Validated\", \"label\": \"Validated - No Data\"}, {\"value\": \"Not Configured\", \"label\": \"Not Configured\"}]"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "75",
            "name": "Global Parameters"
          }
        ],
        "exportParameters": true
      },
      "name": "ParentGroup"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, CheckId:string, SentinelTable:string) [\r\n    'Entra ID', 'SigninLogs', 'SigninLogs',\r\n    'Entra ID', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs',\r\n    'Entra ID', 'AuditLogs', 'AuditLogs',\r\n    'Entra ID', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs',\r\n    'Entra ID', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs',\r\n    'Entra ID', 'AADProvisioningLogs', 'AADProvisioningLogs',\r\n    'Entra ID', 'AADRiskyUsers', 'AADRiskyUsers',\r\n    'Entra ID', 'AADUserRiskEvents', 'AADUserRiskEvents',\r\n    'Entra ID', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals',\r\n    'Entra ID', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents',\r\n    'Entra ID', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs',\r\n    'Azure Activity', 'AzureActivity', 'AzureActivity',\r\n    'Azure Firewall', 'AZFWApplicationRule', 'AZFWApplicationRule',\r\n    'Azure Firewall', 'AZFWNetworkRule', 'AZFWNetworkRule',\r\n    'Azure Firewall', 'AZFWThreatIntel', 'AZFWThreatIntel',\r\n    'Azure Firewall', 'AZFWDnsQuery', 'AZFWDnsQuery',\r\n    'Azure Firewall', 'AZFWNatRule', 'AZFWNatRule',\r\n    'Azure Firewall', 'AZFWIdpsSignature', 'AZFWIdpsSignature',\r\n    'Azure Firewall', 'AZFWFlowTrace', 'AZFWFlowTrace',\r\n    'VPN Gateway', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics',\r\n    'ExpressRoute', 'AzDiag_EXPRESSROUTEGATEWAYS', 'AzureDiagnostics',\r\n    'ExpressRoute', 'AzDiag_EXPRESSROUTECIRCUITS', 'AzureDiagnostics',\r\n    'Virtual WAN', 'AzDiag_VIRTUALWANS', 'AzureDiagnostics',\r\n    'Virtual WAN', 'AzDiag_VIRTUALHUBS', 'AzureDiagnostics',\r\n    'Key Vault', 'AzDiag_VAULTS', 'AzureDiagnostics',\r\n    'Key Vault', 'AZKVAuditLogs', 'AZKVAuditLogs',\r\n    'Key Vault', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs',\r\n    'Storage Account', 'StorageBlobLogs', 'StorageBlobLogs',\r\n    'Storage Account', 'StorageQueueLogs', 'StorageQueueLogs',\r\n    'Storage Account', 'StorageTableLogs', 'StorageTableLogs',\r\n    'Storage Account', 'StorageFileLogs', 'StorageFileLogs',\r\n    'Recovery Services', 'CoreAzureBackup', 'CoreAzureBackup',\r\n    'Recovery Services', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs',\r\n    'Recovery Services', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy',\r\n    'Recovery Services', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage',\r\n    'Recovery Services', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts',\r\n    'Recovery Services', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance',\r\n    'Recovery Services', 'AzureBackupOperations', 'AzureBackupOperations',\r\n    'Recovery Services', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics',\r\n    'Recovery Services', 'ASRJobs', 'ASRJobs',\r\n    'Recovery Services', 'ASRReplicatedItems', 'ASRReplicatedItems',\r\n    'NSG Flow Logs', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL',\r\n    'NSG Flow Logs', 'NTANetAnalytics', 'NTANetAnalytics',\r\n    'DNS', 'AzDiag_DNSRESOLVERS', 'AzureDiagnostics',\r\n    'DNS', 'AzDiag_PRIVATEDNSZONES', 'AzureDiagnostics',\r\n    'Event Hub', 'AzDiag_NAMESPACES', 'AzureDiagnostics',\r\n    'Automation Account', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics',\r\n    'AVD', 'WVDConnections', 'WVDConnections',\r\n    'AVD', 'WVDCheckpoints', 'WVDCheckpoints',\r\n    'AVD', 'WVDErrors', 'WVDErrors',\r\n    'AVD', 'WVDManagement', 'WVDManagement',\r\n    'AVD', 'WVDHostRegistrations', 'WVDHostRegistrations',\r\n    'AVD', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus',\r\n    'AVD', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData',\r\n    'AVD', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview',\r\n    'AVD', 'WVDSessionHostManagement', 'WVDSessionHostManagement',\r\n    'AVD', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled',\r\n    'AVD', 'WVDFeeds', 'WVDFeeds',\r\n    'VMs / Hosts', 'SecurityEvent', 'SecurityEvent',\r\n    'VMs / Hosts', 'Event', 'Event',\r\n    'VMs / Hosts', 'Heartbeat', 'Heartbeat',\r\n    'VMs / Hosts', 'Perf', 'Perf',\r\n    'VMs / Hosts', 'InsightsMetrics', 'InsightsMetrics',\r\n    'SD-WAN / NVA', 'Syslog', 'Syslog',\r\n    'SD-WAN / NVA', 'CommonSecurityLog', 'CommonSecurityLog',\r\n    'Defender for Cloud', 'SecurityAlert', 'SecurityAlert',\r\n    'Defender for Cloud', 'SecurityRecommendation', 'SecurityRecommendation',\r\n    'Defender for Cloud', 'SecurityRegulatoryCompliance', 'SecurityRegulatoryCompliance',\r\n    'Sentinel', 'SecurityIncident', 'SecurityIncident',\r\n    'Sentinel', 'SentinelHealth', 'SentinelHealth',\r\n    'Sentinel', 'SentinelAudit', 'SentinelAudit',\r\n    'Sentinel', 'LAQueryLogs', 'LAQueryLogs',\r\n    'Sentinel', 'ThreatIntelligenceIndicator', 'ThreatIntelligenceIndicator',\r\n    'Sentinel', 'Anomalies', 'Anomalies'\r\n];\r\nlet Filtered = Expected | where '{SelectedComponent}' == 'All' or Workload == '{SelectedComponent}';\r\nlet TotalExpected = toscalar(Filtered | count);\r\nlet SchemaCheck = union isfuzzy=true\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | getschema | take 1 | project T='StorageBlobLogs'),\r\n    (StorageQueueLogs | getschema | take 1 | project T='StorageQueueLogs'),\r\n    (StorageTableLogs | getschema | take 1 | project T='StorageTableLogs'),\r\n    (StorageFileLogs | getschema | take 1 | project T='StorageFileLogs'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (SecurityEvent | getschema | take 1 | project T='SecurityEvent'),\r\n    (Event | getschema | take 1 | project T='Event'),\r\n    (Heartbeat | getschema | take 1 | project T='Heartbeat'),\r\n    (Perf | getschema | take 1 | project T='Perf'),\r\n    (InsightsMetrics | getschema | take 1 | project T='InsightsMetrics'),\r\n    (Syslog | getschema | take 1 | project T='Syslog'),\r\n    (CommonSecurityLog | getschema | take 1 | project T='CommonSecurityLog'),\r\n    (SecurityAlert | getschema | take 1 | project T='SecurityAlert'),\r\n    (SecurityRecommendation | getschema | take 1 | project T='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | getschema | take 1 | project T='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | getschema | take 1 | project T='SecurityIncident'),\r\n    (SentinelHealth | getschema | take 1 | project T='SentinelHealth'),\r\n    (SentinelAudit | getschema | take 1 | project T='SentinelAudit'),\r\n    (LAQueryLogs | getschema | take 1 | project T='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | getschema | take 1 | project T='ThreatIntelligenceIndicator'),\r\n    (Anomalies | getschema | take 1 | project T='Anomalies')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureActivity'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZFWFlowTrace'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTEGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_EXPRESSROUTEGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTECIRCUITS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_EXPRESSROUTECIRCUITS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALWANS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VIRTUALWANS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALHUBS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VIRTUALHUBS'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='StorageBlobLogs'),\r\n    (StorageQueueLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='StorageQueueLogs'),\r\n    (StorageTableLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='StorageTableLogs'),\r\n    (StorageFileLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='StorageFileLogs'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='NTANetAnalytics'),\r\n    (AzureDiagnostics | where ResourceType == \"DNSRESOLVERS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_DNSRESOLVERS'),\r\n    (AzureDiagnostics | where ResourceType == \"PRIVATEDNSZONES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_PRIVATEDNSZONES'),\r\n    (AzureDiagnostics | where ResourceType == \"NAMESPACES\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_NAMESPACES'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='WVDFeeds'),\r\n    (SecurityEvent | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SecurityEvent'),\r\n    (Event | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='Event'),\r\n    (Heartbeat | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='Heartbeat'),\r\n    (Perf | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='Perf'),\r\n    (InsightsMetrics | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='InsightsMetrics'),\r\n    (Syslog | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='Syslog'),\r\n    (CommonSecurityLog | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='CommonSecurityLog'),\r\n    (SecurityAlert | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SecurityAlert'),\r\n    (SecurityRecommendation | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SecurityIncident'),\r\n    (SentinelHealth | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SentinelHealth'),\r\n    (SentinelAudit | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='SentinelAudit'),\r\n    (LAQueryLogs | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='ThreatIntelligenceIndicator'),\r\n    (Anomalies | where TimeGenerated > ago({TimeRange}) | take 1 | project CheckId='Anomalies')\r\n| distinct CheckId;\r\nFiltered\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend HasData = CheckId in (DataCheck)\r\n| extend State = case(HasData, 'Ingesting', TableInSchema, 'Validated', 'NotConfigured')\r\n| summarize Ingesting=countif(State=='Ingesting'), Validated=countif(State=='Validated'), NotConfigured=countif(State=='NotConfigured')\r\n| extend Total = Ingesting + Validated + NotConfigured\r\n| extend CoveragePct = round(todouble(Ingesting) / Total * 100, 1)\r\n| project ['✅ Ingesting']=Ingesting, ['⚠️ Validated']=Validated, ['❌ Not Configured']=NotConfigured, Total, ['Coverage %']=CoveragePct",
        "size": 4,
        "title": "ATO Readiness",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Ingesting",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            },
            {
              "columnMatch": "Validated",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            },
            {
              "columnMatch": "Not Configured",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "155px"
              }
            },
            {
              "columnMatch": "Total",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "70px"
              }
            },
            {
              "columnMatch": "Coverage %",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">=",
                    "thresholdValue": "80",
                    "representation": "green",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "60",
                    "representation": "yellow",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "40",
                    "representation": "orange",
                    "text": "{0}{1}%"
                  },
                  {
                    "operator": "Default",
                    "representation": "redBright",
                    "text": "{0}{1}%"
                  }
                ],
                "customColumnWidthSetting": "125px"
              }
            }
          ]
        }
      },
      "customWidth": "30",
      "name": "Readiness Summary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, CheckId:string, SentinelTable:string) [\r\n    'Entra ID', 'SigninLogs', 'SigninLogs',\r\n    'Entra ID', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs',\r\n    'Entra ID', 'AuditLogs', 'AuditLogs',\r\n    'Entra ID', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs',\r\n    'Entra ID', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs',\r\n    'Entra ID', 'AADProvisioningLogs', 'AADProvisioningLogs',\r\n    'Entra ID', 'AADRiskyUsers', 'AADRiskyUsers',\r\n    'Entra ID', 'AADUserRiskEvents', 'AADUserRiskEvents',\r\n    'Entra ID', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals',\r\n    'Entra ID', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents',\r\n    'Entra ID', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs',\r\n    'Azure Activity', 'AzureActivity', 'AzureActivity',\r\n    'Azure Firewall', 'AZFWApplicationRule', 'AZFWApplicationRule',\r\n    'Azure Firewall', 'AZFWNetworkRule', 'AZFWNetworkRule',\r\n    'Azure Firewall', 'AZFWThreatIntel', 'AZFWThreatIntel',\r\n    'Azure Firewall', 'AZFWDnsQuery', 'AZFWDnsQuery',\r\n    'Azure Firewall', 'AZFWNatRule', 'AZFWNatRule',\r\n    'Azure Firewall', 'AZFWIdpsSignature', 'AZFWIdpsSignature',\r\n    'Azure Firewall', 'AZFWFlowTrace', 'AZFWFlowTrace',\r\n    'VPN Gateway', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics',\r\n    'ExpressRoute', 'AzDiag_EXPRESSROUTEGATEWAYS', 'AzureDiagnostics',\r\n    'ExpressRoute', 'AzDiag_EXPRESSROUTECIRCUITS', 'AzureDiagnostics',\r\n    'Virtual WAN', 'AzDiag_VIRTUALWANS', 'AzureDiagnostics',\r\n    'Virtual WAN', 'AzDiag_VIRTUALHUBS', 'AzureDiagnostics',\r\n    'Key Vault', 'AzDiag_VAULTS', 'AzureDiagnostics',\r\n    'Key Vault', 'AZKVAuditLogs', 'AZKVAuditLogs',\r\n    'Key Vault', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs',\r\n    'Storage Account', 'StorageBlobLogs', 'StorageBlobLogs',\r\n    'Storage Account', 'StorageQueueLogs', 'StorageQueueLogs',\r\n    'Storage Account', 'StorageTableLogs', 'StorageTableLogs',\r\n    'Storage Account', 'StorageFileLogs', 'StorageFileLogs',\r\n    'Recovery Services', 'CoreAzureBackup', 'CoreAzureBackup',\r\n    'Recovery Services', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs',\r\n    'Recovery Services', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy',\r\n    'Recovery Services', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage',\r\n    'Recovery Services', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts',\r\n    'Recovery Services', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance',\r\n    'Recovery Services', 'AzureBackupOperations', 'AzureBackupOperations',\r\n    'Recovery Services', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics',\r\n    'Recovery Services', 'ASRJobs', 'ASRJobs',\r\n    'Recovery Services', 'ASRReplicatedItems', 'ASRReplicatedItems',\r\n    'NSG Flow Logs', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL',\r\n    'NSG Flow Logs', 'NTANetAnalytics', 'NTANetAnalytics',\r\n    'DNS', 'AzDiag_DNSRESOLVERS', 'AzureDiagnostics',\r\n    'DNS', 'AzDiag_PRIVATEDNSZONES', 'AzureDiagnostics',\r\n    'Event Hub', 'AzDiag_NAMESPACES', 'AzureDiagnostics',\r\n    'Automation Account', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics',\r\n    'AVD', 'WVDConnections', 'WVDConnections',\r\n    'AVD', 'WVDCheckpoints', 'WVDCheckpoints',\r\n    'AVD', 'WVDErrors', 'WVDErrors',\r\n    'AVD', 'WVDManagement', 'WVDManagement',\r\n    'AVD', 'WVDHostRegistrations', 'WVDHostRegistrations',\r\n    'AVD', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus',\r\n    'AVD', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData',\r\n    'AVD', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview',\r\n    'AVD', 'WVDSessionHostManagement', 'WVDSessionHostManagement',\r\n    'AVD', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled',\r\n    'AVD', 'WVDFeeds', 'WVDFeeds',\r\n    'VMs / Hosts', 'SecurityEvent', 'SecurityEvent',\r\n    'VMs / Hosts', 'Event', 'Event',\r\n    'VMs / Hosts', 'Heartbeat', 'Heartbeat',\r\n    'VMs / Hosts', 'Perf', 'Perf',\r\n    'VMs / Hosts', 'InsightsMetrics', 'InsightsMetrics',\r\n    'SD-WAN / NVA', 'Syslog', 'Syslog',\r\n    'SD-WAN / NVA', 'CommonSecurityLog', 'CommonSecurityLog',\r\n    'Defender for Cloud', 'SecurityAlert', 'SecurityAlert',\r\n    'Defender for Cloud', 'SecurityRecommendation', 'SecurityRecommendation',\r\n    'Defender for Cloud', 'SecurityRegulatoryCompliance', 'SecurityRegulatoryCompliance',\r\n    'Sentinel', 'SecurityIncident', 'SecurityIncident',\r\n    'Sentinel', 'SentinelHealth', 'SentinelHealth',\r\n    'Sentinel', 'SentinelAudit', 'SentinelAudit',\r\n    'Sentinel', 'LAQueryLogs', 'LAQueryLogs',\r\n    'Sentinel', 'ThreatIntelligenceIndicator', 'ThreatIntelligenceIndicator',\r\n    'Sentinel', 'Anomalies', 'Anomalies'\r\n];\r\nlet SchemaCheck = union isfuzzy=true\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | getschema | take 1 | project T='StorageBlobLogs'),\r\n    (StorageQueueLogs | getschema | take 1 | project T='StorageQueueLogs'),\r\n    (StorageTableLogs | getschema | take 1 | project T='StorageTableLogs'),\r\n    (StorageFileLogs | getschema | take 1 | project T='StorageFileLogs'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (SecurityEvent | getschema | take 1 | project T='SecurityEvent'),\r\n    (Event | getschema | take 1 | project T='Event'),\r\n    (Heartbeat | getschema | take 1 | project T='Heartbeat'),\r\n    (Perf | getschema | take 1 | project T='Perf'),\r\n    (InsightsMetrics | getschema | take 1 | project T='InsightsMetrics'),\r\n    (Syslog | getschema | take 1 | project T='Syslog'),\r\n    (CommonSecurityLog | getschema | take 1 | project T='CommonSecurityLog'),\r\n    (SecurityAlert | getschema | take 1 | project T='SecurityAlert'),\r\n    (SecurityRecommendation | getschema | take 1 | project T='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | getschema | take 1 | project T='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | getschema | take 1 | project T='SecurityIncident'),\r\n    (SentinelHealth | getschema | take 1 | project T='SentinelHealth'),\r\n    (SentinelAudit | getschema | take 1 | project T='SentinelAudit'),\r\n    (LAQueryLogs | getschema | take 1 | project T='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | getschema | take 1 | project T='ThreatIntelligenceIndicator'),\r\n    (Anomalies | getschema | take 1 | project T='Anomalies')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureActivity'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWFlowTrace'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTEGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_EXPRESSROUTEGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTECIRCUITS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_EXPRESSROUTECIRCUITS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALWANS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VIRTUALWANS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALHUBS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VIRTUALHUBS'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageBlobLogs'),\r\n    (StorageQueueLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageQueueLogs'),\r\n    (StorageTableLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageTableLogs'),\r\n    (StorageFileLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageFileLogs'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='NTANetAnalytics'),\r\n    (AzureDiagnostics | where ResourceType == \"DNSRESOLVERS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_DNSRESOLVERS'),\r\n    (AzureDiagnostics | where ResourceType == \"PRIVATEDNSZONES\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_PRIVATEDNSZONES'),\r\n    (AzureDiagnostics | where ResourceType == \"NAMESPACES\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_NAMESPACES'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDFeeds'),\r\n    (SecurityEvent | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityEvent'),\r\n    (Event | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Event'),\r\n    (Heartbeat | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Heartbeat'),\r\n    (Perf | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Perf'),\r\n    (InsightsMetrics | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='InsightsMetrics'),\r\n    (Syslog | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Syslog'),\r\n    (CommonSecurityLog | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='CommonSecurityLog'),\r\n    (SecurityAlert | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityAlert'),\r\n    (SecurityRecommendation | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityIncident'),\r\n    (SentinelHealth | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SentinelHealth'),\r\n    (SentinelAudit | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SentinelAudit'),\r\n    (LAQueryLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ThreatIntelligenceIndicator'),\r\n    (Anomalies | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Anomalies')\r\n;\r\nExpected\r\n| join kind=leftouter (DataCheck) on CheckId\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend State = case(isnotnull(Last), 'Ingesting', TableInSchema, 'Validated', 'Not Configured')\r\n| summarize ['Ingesting']=countif(State=='Ingesting'), ['Validated No Data']=countif(State=='Validated'), ['Not Configured']=countif(State=='Not Configured') by Workload\r\n| sort by ['Not Configured'] desc, Workload asc",
        "size": 1,
        "title": "Coverage by Workload",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "xAxis": "Workload",
          "yAxis": [
            "Ingesting",
            "Validated No Data",
            "Not Configured"
          ],
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "Ingesting",
              "color": "green"
            },
            {
              "seriesName": "Validated No Data",
              "color": "yellow"
            },
            {
              "seriesName": "Not Configured",
              "color": "redBright"
            }
          ]
        }
      },
      "customWidth": "60",
      "name": "Coverage Bar Chart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Expected = datatable(Workload:string, DisplayName:string, CheckId:string, SentinelTable:string, EnableLink:string, Controls:string, ResourceFilter:string) [\r\n    'Entra ID', 'Sign-in Logs', 'SigninLogs', 'SigninLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2, AU-3', '',\r\n    'Entra ID', 'Non-Interactive Sign-ins', 'AADNonInteractiveUserSignInLogs', 'AADNonInteractiveUserSignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2, AU-3', '',\r\n    'Entra ID', 'Audit Logs', 'AuditLogs', 'AuditLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, AC-6, AU-2, AU-3, AU-12', '',\r\n    'Entra ID', 'Service Principal Sign-ins', 'AADServicePrincipalSignInLogs', 'AADServicePrincipalSignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, AU-2', '',\r\n    'Entra ID', 'Managed Identity Sign-ins', 'AADManagedIdentitySignInLogs', 'AADManagedIdentitySignInLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, IA-2, IA-4, AU-2', '',\r\n    'Entra ID', 'Provisioning Logs', 'AADProvisioningLogs', 'AADProvisioningLogs', 'https://learn.microsoft.com/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs', 'AC-2, AU-2, AU-12', '',\r\n    'Entra ID', 'Risky Users', 'AADRiskyUsers', 'AADRiskyUsers', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'User Risk Events', 'AADUserRiskEvents', 'AADUserRiskEvents', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'Risky Service Principals', 'AADRiskyServicePrincipals', 'AADRiskyServicePrincipals', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4', '',\r\n    'Entra ID', 'SP Risk Events', 'AADServicePrincipalRiskEvents', 'AADServicePrincipalRiskEvents', 'https://learn.microsoft.com/entra/id-protection/howto-export-risk-data', 'AC-2, IA-5, SI-4, RA-5', '',\r\n    'Entra ID', 'Graph Activity Logs', 'MicrosoftGraphActivityLogs', 'MicrosoftGraphActivityLogs', 'https://learn.microsoft.com/graph/microsoft-graph-activity-logs-overview', 'AC-2, AC-6, AU-2, AU-3, SI-4', '',\r\n    'Azure Activity', 'Activity Logs', 'AzureActivity', 'AzureActivity', 'https://learn.microsoft.com/azure/azure-monitor/essentials/activity-log', 'AU-2, AU-3, AU-6, AU-12, CM-3', '',\r\n    'Azure Firewall', 'Application Rules', 'AZFWApplicationRule', 'AZFWApplicationRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'Azure Firewall', 'Network Rules', 'AZFWNetworkRule', 'AZFWNetworkRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'Azure Firewall', 'Threat Intel', 'AZFWThreatIntel', 'AZFWThreatIntel', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SI-4, SI-3', '',\r\n    'Azure Firewall', 'DNS Queries', 'AZFWDnsQuery', 'AZFWDnsQuery', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SC-20, SI-4', '',\r\n    'Azure Firewall', 'NAT Rules', 'AZFWNatRule', 'AZFWNatRule', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, AC-4', '',\r\n    'Azure Firewall', 'IDPS Signatures', 'AZFWIdpsSignature', 'AZFWIdpsSignature', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, SI-3, SI-4', '',\r\n    'Azure Firewall', 'Flow Trace', 'AZFWFlowTrace', 'AZFWFlowTrace', 'https://learn.microsoft.com/azure/firewall/firewall-structured-logs', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'VPN Gateway', 'Gateway Diagnostics', 'AzDiag_VPNGATEWAYS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/vpn-gateway/monitor-vpn-gateway', 'SC-7, AC-17, AU-2, SC-8', 'VPNGATEWAYS',\r\n    'ExpressRoute', 'ER Gateway Diagnostics', 'AzDiag_EXPRESSROUTEGATEWAYS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/expressroute/monitor-expressroute', 'SC-7, AC-17, AU-2', 'EXPRESSROUTEGATEWAYS',\r\n    'ExpressRoute', 'ER Circuit Diagnostics', 'AzDiag_EXPRESSROUTECIRCUITS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/expressroute/monitor-expressroute', 'SC-7, AC-17, AU-2', 'EXPRESSROUTECIRCUITS',\r\n    'Virtual WAN', 'vWAN Diagnostics', 'AzDiag_VIRTUALWANS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/virtual-wan/monitor-virtual-wan', 'SC-7, AU-2, AC-4', 'VIRTUALWANS',\r\n    'Virtual WAN', 'vHub Diagnostics', 'AzDiag_VIRTUALHUBS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/virtual-wan/monitor-virtual-wan', 'SC-7, AU-2, AC-4', 'VIRTUALHUBS',\r\n    'Key Vault', 'Key Vault Audit Events', 'AzDiag_VAULTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, SC-28, AU-2, AU-3, AC-6', 'VAULTS',\r\n    'Key Vault', 'KV Audit Logs (Resource)', 'AZKVAuditLogs', 'AZKVAuditLogs', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, SC-28, AU-2, AU-3, AC-6', '',\r\n    'Key Vault', 'KV Policy Evaluation', 'AZKVPolicyEvaluationDetailsLogs', 'AZKVPolicyEvaluationDetailsLogs', 'https://learn.microsoft.com/azure/key-vault/general/logging', 'SC-12, CM-6, AU-2', '',\r\n    'Storage Account', 'Blob Logs', 'StorageBlobLogs', 'StorageBlobLogs', 'https://learn.microsoft.com/azure/storage/blobs/monitor-blob-storage', 'AU-2, AU-3, SC-28, AC-3', '',\r\n    'Storage Account', 'Queue Logs', 'StorageQueueLogs', 'StorageQueueLogs', 'https://learn.microsoft.com/azure/storage/queues/monitor-queue-storage', 'AU-2, AU-3, SC-28, AC-3', '',\r\n    'Storage Account', 'Table Logs', 'StorageTableLogs', 'StorageTableLogs', 'https://learn.microsoft.com/azure/storage/tables/monitor-table-storage', 'AU-2, AU-3, SC-28, AC-3', '',\r\n    'Storage Account', 'File Logs', 'StorageFileLogs', 'StorageFileLogs', 'https://learn.microsoft.com/azure/storage/files/storage-files-monitoring', 'AU-2, AU-3, SC-28, AC-3', '',\r\n    'Recovery Services', 'Core Backup', 'CoreAzureBackup', 'CoreAzureBackup', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Recovery Services', 'Backup Jobs', 'AddonAzureBackupJobs', 'AddonAzureBackupJobs', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Recovery Services', 'Backup Policy', 'AddonAzureBackupPolicy', 'AddonAzureBackupPolicy', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, CM-6', '',\r\n    'Recovery Services', 'Backup Storage', 'AddonAzureBackupStorage', 'AddonAzureBackupStorage', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Recovery Services', 'Backup Alerts', 'AddonAzureBackupAlerts', 'AddonAzureBackupAlerts', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, SI-4', '',\r\n    'Recovery Services', 'Protected Instances', 'AddonAzureBackupProtectedInstance', 'AddonAzureBackupProtectedInstance', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, CM-8', '',\r\n    'Recovery Services', 'Backup Operations', 'AzureBackupOperations', 'AzureBackupOperations', 'https://learn.microsoft.com/azure/backup/backup-azure-diagnostic-events', 'CP-9, CP-10, AU-2', '',\r\n    'Recovery Services', 'ASR Events', 'AzDiag_VAULTS_REPLICATIONEVENTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, AU-2', 'VAULTS',\r\n    'Recovery Services', 'ASR Jobs', 'ASRJobs', 'ASRJobs', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, AU-2', '',\r\n    'Recovery Services', 'ASR Replicated Items', 'ASRReplicatedItems', 'ASRReplicatedItems', 'https://learn.microsoft.com/azure/site-recovery/monitor-log-analytics', 'CP-9, CP-10, CM-8', '',\r\n    'NSG Flow Logs', 'Network Analytics', 'AzureNetworkAnalytics_CL', 'AzureNetworkAnalytics_CL', 'https://learn.microsoft.com/azure/network-watcher/nsg-flow-logs-overview', 'SC-7, AU-2, AU-3, SI-4, AC-4', '',\r\n    'NSG Flow Logs', 'NTA Net Analytics', 'NTANetAnalytics', 'NTANetAnalytics', 'https://learn.microsoft.com/azure/network-watcher/traffic-analytics', 'SC-7, AU-2, SI-4, AC-4', '',\r\n    'DNS', 'DNS Resolver Queries', 'AzDiag_DNSRESOLVERS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/dns/private-resolver-endpoints-rulesets', 'SC-7, SC-20, SC-21, AU-2', 'DNSRESOLVERS',\r\n    'DNS', 'Private DNS Zones', 'AzDiag_PRIVATEDNSZONES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/dns/private-dns-logging', 'SC-7, SC-20, SC-21, AU-2', 'PRIVATEDNSZONES',\r\n    'Event Hub', 'Event Hub Diagnostics', 'AzDiag_NAMESPACES', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/event-hubs/monitor-event-hubs', 'AU-2, AU-9, AU-4', 'NAMESPACES',\r\n    'Automation Account', 'Automation Diagnostics', 'AzDiag_AUTOMATIONACCOUNTS', 'AzureDiagnostics', 'https://learn.microsoft.com/azure/automation/automation-manage-send-joblogs-log-analytics', 'CM-3, CM-6, AU-2, AU-12', 'AUTOMATIONACCOUNTS',\r\n    'AVD', 'Connections', 'WVDConnections', 'WVDConnections', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-2, AC-17, AU-2, AU-3', '',\r\n    'AVD', 'Checkpoints', 'WVDCheckpoints', 'WVDCheckpoints', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AU-2, AU-3, SI-4', '',\r\n    'AVD', 'Errors', 'WVDErrors', 'WVDErrors', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AU-2, SI-4, SI-11', '',\r\n    'AVD', 'Management', 'WVDManagement', 'WVDManagement', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-6, AU-2', '',\r\n    'AVD', 'Host Registrations', 'WVDHostRegistrations', 'WVDHostRegistrations', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-8, AU-2', '',\r\n    'AVD', 'Agent Health Status', 'WVDAgentHealthStatus', 'WVDAgentHealthStatus', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'SI-4, CM-8, AU-2', '',\r\n    'AVD', 'Connection Network Data', 'WVDConnectionNetworkData', 'WVDConnectionNetworkData', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-17, SC-7, AU-2', '',\r\n    'AVD', 'Connection Graphics Preview', 'WVDConnectionGraphicsDataPreview', 'WVDConnectionGraphicsDataPreview', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-17, AU-2', '',\r\n    'AVD', 'Session Host Mgmt', 'WVDSessionHostManagement', 'WVDSessionHostManagement', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-3, CM-6, AU-2', '',\r\n    'AVD', 'Autoscale Pooled', 'WVDAutoscaleEvaluationPooled', 'WVDAutoscaleEvaluationPooled', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'CM-6, AU-2', '',\r\n    'AVD', 'Feeds', 'WVDFeeds', 'WVDFeeds', 'https://learn.microsoft.com/azure/virtual-desktop/diagnostics-log-analytics', 'AC-2, AU-2, CM-6', '',\r\n    'VMs / Hosts', 'Windows Security Events', 'SecurityEvent', 'SecurityEvent', 'https://learn.microsoft.com/azure/sentinel/data-connectors/windows-security-events-via-ama', 'AU-2, AU-3, AU-6, SI-4, AC-2', '',\r\n    'VMs / Hosts', 'Windows Events', 'Event', 'Event', 'https://learn.microsoft.com/azure/azure-monitor/agents/data-collection-windows-events', 'AU-2, AU-3, AU-12', '',\r\n    'VMs / Hosts', 'Heartbeat (Agent)', 'Heartbeat', 'Heartbeat', 'https://learn.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-overview', 'CM-8, SI-4', '',\r\n    'VMs / Hosts', 'Performance Counters', 'Perf', 'Perf', 'https://learn.microsoft.com/azure/azure-monitor/agents/data-collection-performance', 'AU-2, SI-4, CM-8', '',\r\n    'VMs / Hosts', 'VM Insights Metrics', 'InsightsMetrics', 'InsightsMetrics', 'https://learn.microsoft.com/azure/azure-monitor/vm/vminsights-overview', 'SI-4, CM-8', '',\r\n    'SD-WAN / NVA', 'Syslog', 'Syslog', 'Syslog', 'https://learn.microsoft.com/azure/sentinel/connect-syslog', 'SC-7, AU-2, AU-3, SI-4', '',\r\n    'SD-WAN / NVA', 'CEF (CommonSecurityLog)', 'CommonSecurityLog', 'CommonSecurityLog', 'https://learn.microsoft.com/azure/sentinel/connect-common-event-format', 'SC-7, AU-2, AU-3, SI-4', '',\r\n    'Defender for Cloud', 'Security Alerts', 'SecurityAlert', 'SecurityAlert', 'https://learn.microsoft.com/azure/sentinel/connect-defender-for-cloud', 'SI-4, RA-5, IR-4, IR-5', '',\r\n    'Defender for Cloud', 'Recommendations', 'SecurityRecommendation', 'SecurityRecommendation', 'https://learn.microsoft.com/azure/sentinel/connect-defender-for-cloud', 'RA-5, SI-4, CM-6', '',\r\n    'Defender for Cloud', 'Regulatory Compliance', 'SecurityRegulatoryCompliance', 'SecurityRegulatoryCompliance', 'https://learn.microsoft.com/azure/defender-for-cloud/regulatory-compliance-dashboard', 'RA-5, CM-6, AU-2', '',\r\n    'Sentinel', 'Incidents', 'SecurityIncident', 'SecurityIncident', 'https://learn.microsoft.com/azure/sentinel/investigate-incidents', 'IR-4, IR-5, AU-6, SI-4', '',\r\n    'Sentinel', 'Health Diagnostics', 'SentinelHealth', 'SentinelHealth', 'https://learn.microsoft.com/azure/sentinel/monitor-sentinel-health', 'AU-2, SI-4, AU-9', '',\r\n    'Sentinel', 'Audit Logs', 'SentinelAudit', 'SentinelAudit', 'https://learn.microsoft.com/azure/sentinel/audit-sentinel-data', 'AU-2, AU-3, AU-12, AC-6', '',\r\n    'Sentinel', 'Workspace Query Audit', 'LAQueryLogs', 'LAQueryLogs', 'https://learn.microsoft.com/azure/azure-monitor/logs/query-audit', 'AU-2, AU-3, AU-12, AC-6', '',\r\n    'Sentinel', 'Threat Intelligence', 'ThreatIntelligenceIndicator', 'ThreatIntelligenceIndicator', 'https://learn.microsoft.com/azure/sentinel/understand-threat-intelligence', 'SI-4, SI-3, RA-5', '',\r\n    'Sentinel', 'Anomalies (ML)', 'Anomalies', 'Anomalies', 'https://learn.microsoft.com/azure/sentinel/anomalies-reference', 'SI-4, RA-5, IR-4', ''\r\n];\r\nlet SchemaCheck = union isfuzzy=true\r\n    (SigninLogs | getschema | take 1 | project T='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | getschema | take 1 | project T='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | getschema | take 1 | project T='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | getschema | take 1 | project T='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | getschema | take 1 | project T='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | getschema | take 1 | project T='AADProvisioningLogs'),\r\n    (AADRiskyUsers | getschema | take 1 | project T='AADRiskyUsers'),\r\n    (AADUserRiskEvents | getschema | take 1 | project T='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | getschema | take 1 | project T='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | getschema | take 1 | project T='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | getschema | take 1 | project T='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | getschema | take 1 | project T='AzureActivity'),\r\n    (AZFWApplicationRule | getschema | take 1 | project T='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | getschema | take 1 | project T='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | getschema | take 1 | project T='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | getschema | take 1 | project T='AZFWDnsQuery'),\r\n    (AZFWNatRule | getschema | take 1 | project T='AZFWNatRule'),\r\n    (AZFWIdpsSignature | getschema | take 1 | project T='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | getschema | take 1 | project T='AZFWFlowTrace'),\r\n    (AzureDiagnostics | getschema | take 1 | project T='AzureDiagnostics'),\r\n    (AZKVAuditLogs | getschema | take 1 | project T='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | getschema | take 1 | project T='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | getschema | take 1 | project T='StorageBlobLogs'),\r\n    (StorageQueueLogs | getschema | take 1 | project T='StorageQueueLogs'),\r\n    (StorageTableLogs | getschema | take 1 | project T='StorageTableLogs'),\r\n    (StorageFileLogs | getschema | take 1 | project T='StorageFileLogs'),\r\n    (CoreAzureBackup | getschema | take 1 | project T='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | getschema | take 1 | project T='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | getschema | take 1 | project T='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | getschema | take 1 | project T='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | getschema | take 1 | project T='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | getschema | take 1 | project T='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | getschema | take 1 | project T='AzureBackupOperations'),\r\n    (ASRJobs | getschema | take 1 | project T='ASRJobs'),\r\n    (ASRReplicatedItems | getschema | take 1 | project T='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | getschema | take 1 | project T='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | getschema | take 1 | project T='NTANetAnalytics'),\r\n    (WVDConnections | getschema | take 1 | project T='WVDConnections'),\r\n    (WVDCheckpoints | getschema | take 1 | project T='WVDCheckpoints'),\r\n    (WVDErrors | getschema | take 1 | project T='WVDErrors'),\r\n    (WVDManagement | getschema | take 1 | project T='WVDManagement'),\r\n    (WVDHostRegistrations | getschema | take 1 | project T='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | getschema | take 1 | project T='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | getschema | take 1 | project T='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | getschema | take 1 | project T='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | getschema | take 1 | project T='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | getschema | take 1 | project T='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | getschema | take 1 | project T='WVDFeeds'),\r\n    (SecurityEvent | getschema | take 1 | project T='SecurityEvent'),\r\n    (Event | getschema | take 1 | project T='Event'),\r\n    (Heartbeat | getschema | take 1 | project T='Heartbeat'),\r\n    (Perf | getschema | take 1 | project T='Perf'),\r\n    (InsightsMetrics | getschema | take 1 | project T='InsightsMetrics'),\r\n    (Syslog | getschema | take 1 | project T='Syslog'),\r\n    (CommonSecurityLog | getschema | take 1 | project T='CommonSecurityLog'),\r\n    (SecurityAlert | getschema | take 1 | project T='SecurityAlert'),\r\n    (SecurityRecommendation | getschema | take 1 | project T='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | getschema | take 1 | project T='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | getschema | take 1 | project T='SecurityIncident'),\r\n    (SentinelHealth | getschema | take 1 | project T='SentinelHealth'),\r\n    (SentinelAudit | getschema | take 1 | project T='SentinelAudit'),\r\n    (LAQueryLogs | getschema | take 1 | project T='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | getschema | take 1 | project T='ThreatIntelligenceIndicator'),\r\n    (Anomalies | getschema | take 1 | project T='Anomalies')\r\n| distinct T;\r\nlet DataCheck = union isfuzzy=true\r\n    (SigninLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SigninLogs'),\r\n    (AADNonInteractiveUserSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADNonInteractiveUserSignInLogs'),\r\n    (AuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AuditLogs'),\r\n    (AADServicePrincipalSignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADServicePrincipalSignInLogs'),\r\n    (AADManagedIdentitySignInLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADManagedIdentitySignInLogs'),\r\n    (AADProvisioningLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADProvisioningLogs'),\r\n    (AADRiskyUsers | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADRiskyUsers'),\r\n    (AADUserRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADUserRiskEvents'),\r\n    (AADRiskyServicePrincipals | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADRiskyServicePrincipals'),\r\n    (AADServicePrincipalRiskEvents | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AADServicePrincipalRiskEvents'),\r\n    (MicrosoftGraphActivityLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='MicrosoftGraphActivityLogs'),\r\n    (AzureActivity | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureActivity'),\r\n    (AZFWApplicationRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWApplicationRule'),\r\n    (AZFWNetworkRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWNetworkRule'),\r\n    (AZFWThreatIntel | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWThreatIntel'),\r\n    (AZFWDnsQuery | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWDnsQuery'),\r\n    (AZFWNatRule | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWNatRule'),\r\n    (AZFWIdpsSignature | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWIdpsSignature'),\r\n    (AZFWFlowTrace | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZFWFlowTrace'),\r\n    (AzureDiagnostics | where ResourceType == \"VPNGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VPNGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTEGATEWAYS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_EXPRESSROUTEGATEWAYS'),\r\n    (AzureDiagnostics | where ResourceType == \"EXPRESSROUTECIRCUITS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_EXPRESSROUTECIRCUITS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALWANS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VIRTUALWANS'),\r\n    (AzureDiagnostics | where ResourceType == \"VIRTUALHUBS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VIRTUALHUBS'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VAULTS'),\r\n    (AZKVAuditLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZKVAuditLogs'),\r\n    (AZKVPolicyEvaluationDetailsLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AZKVPolicyEvaluationDetailsLogs'),\r\n    (StorageBlobLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageBlobLogs'),\r\n    (StorageQueueLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageQueueLogs'),\r\n    (StorageTableLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageTableLogs'),\r\n    (StorageFileLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='StorageFileLogs'),\r\n    (CoreAzureBackup | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='CoreAzureBackup'),\r\n    (AddonAzureBackupJobs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupJobs'),\r\n    (AddonAzureBackupPolicy | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupPolicy'),\r\n    (AddonAzureBackupStorage | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupStorage'),\r\n    (AddonAzureBackupAlerts | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupAlerts'),\r\n    (AddonAzureBackupProtectedInstance | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AddonAzureBackupProtectedInstance'),\r\n    (AzureBackupOperations | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureBackupOperations'),\r\n    (AzureDiagnostics | where ResourceType == \"VAULTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_VAULTS_REPLICATIONEVENTS'),\r\n    (ASRJobs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ASRJobs'),\r\n    (ASRReplicatedItems | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ASRReplicatedItems'),\r\n    (AzureNetworkAnalytics_CL | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzureNetworkAnalytics_CL'),\r\n    (NTANetAnalytics | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='NTANetAnalytics'),\r\n    (AzureDiagnostics | where ResourceType == \"DNSRESOLVERS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_DNSRESOLVERS'),\r\n    (AzureDiagnostics | where ResourceType == \"PRIVATEDNSZONES\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_PRIVATEDNSZONES'),\r\n    (AzureDiagnostics | where ResourceType == \"NAMESPACES\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_NAMESPACES'),\r\n    (AzureDiagnostics | where ResourceType == \"AUTOMATIONACCOUNTS\" | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='AzDiag_AUTOMATIONACCOUNTS'),\r\n    (WVDConnections | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnections'),\r\n    (WVDCheckpoints | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDCheckpoints'),\r\n    (WVDErrors | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDErrors'),\r\n    (WVDManagement | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDManagement'),\r\n    (WVDHostRegistrations | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDHostRegistrations'),\r\n    (WVDAgentHealthStatus | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDAgentHealthStatus'),\r\n    (WVDConnectionNetworkData | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnectionNetworkData'),\r\n    (WVDConnectionGraphicsDataPreview | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDConnectionGraphicsDataPreview'),\r\n    (WVDSessionHostManagement | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDSessionHostManagement'),\r\n    (WVDAutoscaleEvaluationPooled | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDAutoscaleEvaluationPooled'),\r\n    (WVDFeeds | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='WVDFeeds'),\r\n    (SecurityEvent | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityEvent'),\r\n    (Event | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Event'),\r\n    (Heartbeat | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Heartbeat'),\r\n    (Perf | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Perf'),\r\n    (InsightsMetrics | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='InsightsMetrics'),\r\n    (Syslog | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Syslog'),\r\n    (CommonSecurityLog | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='CommonSecurityLog'),\r\n    (SecurityAlert | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityAlert'),\r\n    (SecurityRecommendation | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityRecommendation'),\r\n    (SecurityRegulatoryCompliance | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityRegulatoryCompliance'),\r\n    (SecurityIncident | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SecurityIncident'),\r\n    (SentinelHealth | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SentinelHealth'),\r\n    (SentinelAudit | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='SentinelAudit'),\r\n    (LAQueryLogs | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='LAQueryLogs'),\r\n    (ThreatIntelligenceIndicator | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='ThreatIntelligenceIndicator'),\r\n    (Anomalies | where TimeGenerated > ago({TimeRange}) | take 1 | summarize Last=max(TimeGenerated) | extend CheckId='Anomalies')\r\n;\r\nExpected\r\n| join kind=leftouter (DataCheck) on CheckId\r\n| extend TableInSchema = SentinelTable in (SchemaCheck)\r\n| extend Status = case(\r\n    isnotnull(Last), 'Ingesting',\r\n    TableInSchema, 'Validated - No Data',\r\n    'Not Configured')\r\n| extend LastSeen = case(\r\n    isnotnull(Last), format_datetime(Last, 'yyyy-MM-dd HH:mm'),\r\n    TableInSchema, 'schema only, no data in range',\r\n    'not in workspace')\r\n| where '{SelectedComponent}' == 'All' or Workload == '{SelectedComponent}'\r\n| where '{SelectedFamily}' == 'All' or Controls has '{SelectedFamily}'\r\n| where '{SelectedTableFilter}' == '' or SentinelTable contains '{SelectedTableFilter}'\r\n| where '{SelectedStatus}' == 'All' or Status has '{SelectedStatus}'\r\n| extend _fam = strcat(iff(Controls has 'AC-', 'Access Control, ', ''), iff(Controls has 'AU-', 'Audit & Accountability, ', ''), iff(Controls has 'CM-', 'Config Management, ', ''), iff(Controls has 'CP-', 'Contingency Planning, ', ''), iff(Controls has 'IA-', 'Identification & Auth, ', ''), iff(Controls has 'IR-', 'Incident Response, ', ''), iff(Controls has 'RA-', 'Risk Assessment, ', ''), iff(Controls has 'SC-', 'System & Comms Protection, ', ''), iff(Controls has 'SI-', 'System & Info Integrity, ', ''))\r\n| extend ['Control Family'] = trim_end(', ', _fam)\r\n| extend _sort = case(Status has 'Not', 0, Status has 'Validated', 1, 2)\r\n| sort by _sort asc, Workload asc, DisplayName asc\r\n| project Workload, ['Table']=SentinelTable, Status, ['Last Record']=LastSeen, ['Control Family'], ['NIST 800-53']=Controls, ['Enable']=EnableLink, ResourceFilter",
        "size": 0,
        "showAnalytics": true,
        "title": "Table Ingestion Status",
        "exportedParameters": [
          {
            "fieldName": "Table",
            "parameterName": "SelectedTable",
            "parameterType": 1
          },
          {
            "fieldName": "ResourceFilter",
            "parameterName": "SelectedResourceFilter",
            "parameterType": 1
          }
        ],
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Workload",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "130px"
              }
            },
            {
              "columnMatch": "Table",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "250px"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Ingesting",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Validated",
                    "representation": "warning",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not Configured",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "representation": "question",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "190px"
              }
            },
            {
              "columnMatch": "Last Record",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "185px"
              }
            },
            {
              "columnMatch": "Control Family",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "500px"
              }
            },
            {
              "columnMatch": "NIST 800-53",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "190px"
              }
            },
            {
              "columnMatch": "Enable",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Docs →",
                "customColumnWidthSetting": "80px"
              }
            },
            {
              "columnMatch": "ResourceFilter",
              "formatter": 5
            }
          ],
          "filter": true
        },
        "sortBy": []
      },
      "name": "Ingestion Status Table"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{SelectedTable}\r\n| where TimeGenerated > ago({TimeRange})\r\n| extend _hasRT = column_ifexists('ResourceType', '')\r\n| where '{SelectedResourceFilter}' == '' or _hasRT == '{SelectedResourceFilter}'\r\n| project-away _hasRT\r\n| project-reorder TimeGenerated\r\n| sort by TimeGenerated desc\r\n| take 50",
        "size": 0,
        "showAnalytics": true,
        "title": "Log Preview — {SelectedTable}",
        "noDataMessage": "⚠️ Check Validation — this table has no records in the selected time range or is not yet configured. Use the 'Docs →' link to enable.",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "filter": true
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "SelectedTable",
          "comparison": "isNotEqualTo",
          "value": ""
        },
        {
          "parameterName": "SelectedTable",
          "comparison": "isNotEqualTo",
          "value": "null"
        }
      ],
      "name": "Log Drill-Down"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/ac95a806-c9d3-49e7-83ee-7f82e88c2bd3/resourcegroups/rg-siem-shared-001/providers/microsoft.operationalinsights/workspaces/log-c3elz7-usgovvirginia-001"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
